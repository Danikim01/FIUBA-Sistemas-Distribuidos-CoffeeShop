{
  "common_environment": {
    "RABBITMQ_HOST": "rabbitmq",
    "RABBITMQ_PORT": 5672,
    "prefetch_count": 20
  },
  "service_environment": {
    "gateway": {
      "TRANSACTIONS_EXCHANGE": "transactions_sharded",
      "TRANSACTION_ITEMS_EXCHANGE": "transaction_items_sharded",
      "RESULTS_QUEUE": "gateway_results",
      "STORES_EXCHANGE": "stores_raw",
      "USERS_QUEUE": "users_raw",
      "MENU_ITEMS_QUEUE": "menu_items_raw",
      "CHUNK_SIZE": 5000,
      "FILTER_REPLICA_COUNT": "3"
    },
    "client": {
      "count": 2,
      "GATEWAY_HOST": "gateway",
      "GATEWAY_PORT": "12345",
      "BATCH_MAX_SIZE_KB": "4096",
      "LOG_LEVEL": "INFO",
      "DATA_DIR": ".data",
      "REDUCED": true,
      "SESSIONS": 1
    }
  },
  "workers": {
    "year_filter_sharding_router": {
      "environment": {
        "INPUT_QUEUE": "transactions_raw",
        "OUTPUT_EXCHANGE": "transactions_sharded",
        "NUM_SHARDS": "3"
      }
    },
    "year_filter": {
      "count": 3,
      "environment": {
        "INPUT_EXCHANGE": "transactions_sharded",
        "INPUT_QUEUE": "transactions_year_filtered_shard",
        "OUTPUT_QUEUE": "transactions_year_filtered_aggregator_input",
        "IS_SHARDED_WORKER": "True"
      }
    },
    "year_filter_eof_barrier": {
      "environment": {
        "INPUT_QUEUE": "transactions_year_filtered_aggregator_input",
        "OUTPUT_EXCHANGE": "transactions_year_filtered",
        "REPLICA_COUNT": "3"
      }
    },
    "items_year_filter_sharding_router": {
      "environment": {
        "INPUT_QUEUE": "transaction_items_raw",
        "OUTPUT_EXCHANGE": "transaction_items_sharded",
        "NUM_SHARDS": "3"
      }
    },
    "items_year_filter": {
      "count": 3,
      "environment": {
        "INPUT_EXCHANGE": "transaction_items_sharded",
        "INPUT_QUEUE": "transaction_items_year_filtered_shard",
        "OUTPUT_QUEUE": "transaction_items_year_filtered_aggregator_input",
        "IS_SHARDED_WORKER": "True"
      }
    },
    "items_year_filter_eof_barrier": {
      "environment": {
        "INPUT_QUEUE": "transaction_items_year_filtered_aggregator_input",
        "OUTPUT_QUEUE": "transaction_items_year_filtered",
        "REPLICA_COUNT": "3"
      }
    },
    "time_filter_sharding_router": {
      "environment": {
        "INPUT_EXCHANGE": "transactions_year_filtered",
        "INPUT_QUEUE": "transactions_year_filtered_time_sharding_router",
        "OUTPUT_EXCHANGE": "transactions_time_sharded",
        "NUM_SHARDS": "3"
      }
    },
    "time_filter": {
      "count": 3,
      "environment": {
        "INPUT_EXCHANGE": "transactions_time_sharded",
        "INPUT_QUEUE": "transactions_time_filtered_shard",
        "OUTPUT_QUEUE": "transactions_time_filtered_aggregator_input",
        "IS_SHARDED_WORKER": "True"
      }
    },
    "time_filter_eof_barrier": {
      "environment": {
        "INPUT_QUEUE": "transactions_time_filtered_aggregator_input",
        "OUTPUT_EXCHANGE": "transactions_time_filtered",
        "REPLICA_COUNT": "3"
      }
    },
    "amount_filter_sharding_router": {
      "environment": {
        "INPUT_EXCHANGE": "transactions_time_filtered",
        "INPUT_QUEUE": "transactions_time_filtered_amount_sharding_router",
        "OUTPUT_EXCHANGE": "transactions_time_filtered_amount_sharded",
        "NUM_SHARDS": "3"
      }
    },
    "amount_filter": {
      "count": 3,
      "environment": {
        "INPUT_EXCHANGE": "transactions_time_filtered_amount_sharded",
        "INPUT_QUEUE": "transactions_time_filtered_amount_shard",
        "OUTPUT_QUEUE": "gateway_results_aggregator_input",
        "IS_SHARDED_WORKER": "True"
      }
    },
    "amount_filter_eof_barrier": {
      "environment": {
        "INPUT_QUEUE": "gateway_results_aggregator_input",
        "OUTPUT_QUEUE": "gateway_results",
        "REPLICA_COUNT": "3"
      }
    },
    "tpv": {
      "count": 3,
      "environment": {
        "INPUT_EXCHANGE": "transactions_time_filtered",
        "INPUT_QUEUE": "transactions_time_filtered_tpv",
        "OUTPUT_QUEUE": "tpv_partial"
      }
    },
    "tpv_sharding_router": {
      "environment": {
        "INPUT_EXCHANGE": "transactions_time_filtered",
        "INPUT_QUEUE": "transactions_time_filtered_tpv_sharding_router",
        "OUTPUT_EXCHANGE": "transactions_time_filtered_tpv_sharded"
      }
    },
    "tpv_sharded": {
      "count": 3,
      "environment": {
        "INPUT_EXCHANGE": "transactions_time_filtered_tpv_sharded",
        "INPUT_QUEUE": "transactions_time_filtered_tpv_shard",
        "OUTPUT_QUEUE": "tpv_partial"
      }
    },
    "items_top": {
      "count": 3,
      "environment": {
        "INPUT_QUEUE": "transaction_items_year_filtered",
        "OUTPUT_QUEUE": "top_items_partial"
      }
    },
    "items_sharding_router": {
      "environment": {
        "INPUT_QUEUE": "transaction_items_year_filtered",
        "OUTPUT_EXCHANGE": "transaction_items_year_filtered_sharded"
      }
    },
    "items_sharded": {
      "count": 3,
      "environment": {
        "INPUT_EXCHANGE": "transaction_items_year_filtered_sharded",
        "INPUT_QUEUE": "transaction_items_year_filtered_shard",
        "OUTPUT_QUEUE": "top_items_partial"
      }
    },
    "top_clients_sharding_router": {
      "environment": {
        "INPUT_EXCHANGE": "transactions_year_filtered",
        "INPUT_QUEUE": "transactions_year_filtered_sharding_router",
        "OUTPUT_EXCHANGE": "transactions_year_filtered_sharded"
      }
    },
    "top_clients": {
      "count": 3,
      "environment": {
        "INPUT_EXCHANGE": "transactions_year_filtered_sharded",
        "INPUT_QUEUE": "transactions_year_filtered_shard",
        "OUTPUT_QUEUE": "top_clients_partial"
      }
    },
    "items_aggregator": {
      "environment": {
        "INPUT_QUEUE": "top_items_partial",
        "OUTPUT_QUEUE": "gateway_results"
      }
    },
    "tpv_aggregator": {
      "environment": {
        "INPUT_QUEUE": "tpv_partial",
        "OUTPUT_QUEUE": "gateway_results"
      }
    },
    "top_clients_birthdays": {
      "environment": {
        "INPUT_QUEUE": "top_clients_partial",
        "OUTPUT_QUEUE": "gateway_results"
      }
    }
  }
}
